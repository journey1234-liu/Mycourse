# 数字信号处理公式

## 信号的采样和重建

### 信号的基本概念

- 离散和连续

  信号从时间域上来说，可以分为两种：时域离散信号和时域连续信号。同样地，从频率域上来说，也可以分为：频域离散信号和频域连续信号。可以说，数字信号处理课程中对于离散信号和连续信号之间的关系，主要关注点是采样（sampling）、重建（reconstruction）以及这两种操作带来的频域上的变化。

- 采样过程和重建过程

  从离散信号到连续信号的**采样过程**可以通过以下的函数实现：
  $$
  x[n]=x_{c}(nT_{s})
  $$
  其中采样周期为$T_{s}$，采样频率$F_{s}=\frac{1}{T_{s}}$。

  从离散信号到连续信号的**重建过程**可以通过以下的函数实现：
  $$
  x_{c}(t)=\sum_{n=-\infty}^{\infty}x[n]sinc(\frac{t-nT_{s}}{T_{s}})=\sum_{n=-\infty}^{\infty}x[n]\frac{\sin(\pi(t-nT_{s}))}{\pi(t-nT_{s})}
  $$
  也就是所谓**sinc插值**。插值函数当然也可以是别的函数，例如零阶保持函数。但是使用sinc函数可以保证频带不泄漏以及信号不失真。因为sinc函数在频域上是一个门限函数。

引入了离散信号和连续信号的联系，二者之间的各种物理量的关系也随之而来。下面就频率论述两者之间的差别。

### 数字频率和物理频率的概念和关系

- 数字周期和物理周期

  对于离散信号来说，周期只是一个整数，设其为$N_{s}$。
  $$
  x[n+rN_{s}]=x[n] \quad r\in\mathbb{Z}
  $$
  对于连续信号，周期就是一个实数了，设其为$T$。

  同样地，存在数字频率和物理频率的概念。并且有频率和角频率的区别。设数字频率为$f$，数字角频率为$\omega$；模拟频率为$F$，模拟角频率为$\Omega$。频率和角频率的关系不言自明：
  $$
  \omega=2\pi f \\
  \Omega=2\pi F
  $$
  对于以周期$T_{s}$采样得到的离散信号，其数字频率和对应的连续信号的物理频率之间的关系为：
  $$
  \omega=\Omega T_{s}=\frac{\Omega}{F_{s}}=2\pi\frac{F}{F_{s}} \\
  f=FT_{s}=\frac{F}{F_{s}}
  $$
  **数字频率$\omega$是模拟角频率$\Omega$被抽样频率$F_{s}$归一化之后的弧度**。这一点一定要牢记。它是连接连续和离散两个体系的桥梁。这个结论是从哪里来的？是从对正弦序列的讨论中推广到一般意义上得来的。

  另外，关于数字周期和数字频率，有以下关系：
  $$
  f=\frac{1}{NT_{s}}
  $$
  当然，数字周期存在的条件是离散信号是一个无限长的周期序列。

### 采样定理

### 带通信号采样

### 频域和时域的对应关系



## 信号的频域变换

## 信号空间

### 基本的线性空间的概念

关于基本的线性空间的概念，诸如加法运算、数乘运算、基向量、内积等不予赘述。这里仅介绍两个极为关键的概念：

- 向量空间的完备性：向量空间内的所有运算结果必须在向量空间内（内积这种不算）。整数集对于除法不封闭，这是一个非常明显的例子。
- 希尔伯特空间（Hilbert space）：一个定义了内积的完备空间。表示为$H(V, \mathbb{C})$。这一概念在控制论中的状态空间理论中也有所体现。

### 离散信号的空间表达

信号的限制条件是平方可加。这是为了无限信号能够加入空间之中。这样定义出来的空间称为$l_{2}(\mathbb{Z})$空间。否则会引起内积发散问题。内积定义如下：
$$
<x, y>=\sum_{n=0}^{N-1}x^{\star}[n]y[n]
$$
上面的表达式针对的是有限长度的向量。

### 信号的基向量分解

对于DFT来说，基向量就是$\omega^{k}[n]$。将一个有限长的信号分解为这些基向量的线性组合，就完成了DFT。

## 滤波器设计

### 模拟IIR

低通的指标

阶数N:

$N \ge lg[\frac{10^{0.1A_{st}}-1}{10^{0.1R_p}-1}]/2lg(\frac{\Omega_{st}}{\Omega_p})$

截止频率$\Omega_c$

$\Omega_c = \Omega_p/\sqrt{10^{0.1R_p}-1}$



#### 四种滤波器的步骤

##### 模拟低通

给定：$f_p,f_{st},A_{st},R_p$

1. $\Omega_p=2\pi f_p,\Omega_{st} = 2\pi f_{st}$
2. 算N，算$\Omega_c$
3. 查表得$H_{an}(s)$
4. $H_{a}(s) = H_{an}(\frac{s}{\Omega_c})$



##### 模拟高通

给定：$f_p,f_{st},A_{st},R_p$

1. $\Omega_p=2\pi f_p,\Omega_{st} = 2\pi f_{st}$
2. $\bar{\Omega}_p = 1,\bar{\Omega}_{st}=-\frac{\Omega_p}{\Omega_{st}}$
3. 算N，算$\bar{\Omega}_c$
4. 查表得出$H_{an}(\bar{s})$
5. $H_a(\bar{s})=H_{an}(\frac{\bar{s}}{\bar{\Omega}_c})$
6. $H_{a}(\bar{s}) = H_a(\bar{s})|_{\bar{s}=\frac{\Omega_p}{s}}$



##### 模拟带通

给定：$f_{p1},f_{p2},f_{st1},f_{st2},R_{p},A_{st}$

1. 计算$\Omega_{p1},\Omega_{p2},\Omega_{st1},\Omega_{st2}$
2. $\bar{\Omega}_p=1$，归一化，计算$\bar{\Omega}_{st}$。$B_p=|\Omega_{st1}-\Omega_{st2}|$,$\Omega_{p0}=\sqrt{\Omega_{p1}\Omega_{p2}}$

$\bar{\Omega}_{st1}=\frac{\Omega_{st1}^2-\Omega_{p0}^2}{\Omega_{st1}B_p}$，$\bar{\Omega}_{st2}$同理，$\bar{\Omega}_{st} = min\{\bar{\Omega}_{st1},\bar{\Omega}_{st2}\}$

3. 用$\bar{\Omega}_{st},\bar{\Omega}_{p}$算$N$和$\bar{\Omega}_{c}$
4. 查表得$H_{an}(\bar{s})$
5. $H_a(\bar{s})=H_{an}(\frac{\bar{s}}{\bar{\Omega}_c})$
6. 频带变换：$H_{bp}(s)= H_a(\bar{s})|_{\bar{s}=\frac{s^2+\Omega_{p0}^2}{s*B_p}}$



##### 模拟带阻

给定：$f_{p1},f_{p2},f_{st1},f_{st2},R_{p},A_{st}$

1. 计算$\Omega_{p1},\Omega_{p2},\Omega_{st1},\Omega_{st2}$
2. $\bar{\Omega}_p=1$，归一化，计算$\bar{\Omega}_{st}$。$B_s=|\Omega_{p1}-\Omega_{p2}|$,$\Omega_{st0}=\sqrt{\Omega_{st1}\Omega_{st2}}$

$\bar{\Omega}_{p1}=\frac{\bar{\Omega}_{st}B_s\Omega_{p1}}{\Omega_{st0}^2-\Omega_{p1}^2}$，$\bar{\Omega}_{p2}$同理，此处得到关于$\bar{\Omega}_{st}$的表达式，$\bar{\Omega}_{p} = max\{\bar{\Omega}_{p1},\bar{\Omega}_{p2}\}$

令$\bar{\Omega}_p=1$，解出$\bar{\Omega}_{st}$

以上，得到归一低通指标

3. 用$\bar{\Omega}_{st},\bar{\Omega}_{p}$算$N$和$\bar{\Omega}_{c}$
4. 查表得$H_{an}(\bar{s})$
5. $H_a(\bar{s})=H_{an}(\frac{\bar{s}}{\bar{\Omega}_c})$
6. 频带变换：$H_{bs}(s)= H_a(\bar{s})|_{\bar{s}=\frac{s*B_s*\bar{\Omega}_{st}}{s^2+\Omega_{st0}^2}}$



### 数字IIR

#### 冲击响应不变法

不能设计高通和带阻

需要频率响应严格带限于$\frac{f_s}{2}$

步骤：

1. 前面步骤和模拟相同，得到$H_a(s)$
2. 将$H_a(s)$展开为部分分式$\sum_{k=1}^{N}\frac{A_kT}{s-s_k}$
3. 代入公式$H(z)=L[T*h_a(nT)]=L[h(n)]=\sum_{k=1}^{N}\frac{A_kT}{1-e^{s_kT}z^{-1}}$。其中sk为系数



#### 双线性变换法

需要预畸$\Omega=\frac{2}{T}tan(\frac{\omega}{2})$

T随便取，一般取2

$s=\frac{1-z^{-1}}{1+z^{-1}}*\frac{2}{T}$

步骤

1. 获取数字角频率 $\omega_p=\frac{\Omega_p}{f_s},\omega_{st}=\frac{\Omega_{st}}{f_s}$
2. 预畸得到模拟的频率：$\Omega_p'=tan\frac{\omega_p}{2},\Omega_{st}'=tan\frac{\omega_{st}}{2}$，注意说明 $T=2$
3. 求出N和截止频率$\Omega_c'$
4. 得到对应的模拟滤波器
5. 双线性变换：$H(z)=H(s)|_{s=\frac{1-z^{-1}}{1+z^{-1}}}$
6. 对于带通带阻滤波器，所有角频率都需要预畸



#### 直接变换法

用双线性变换法直接将模拟低通变到其他的滤波器

##### 数字低通

与双线性变换法一致



##### 数字高通

$s=\frac{1+z^{-1}}{1-z^{-1}}$

$\Omega=cot\frac{\omega}{2}$

给定$f_{st},f_p,f_s,A_{st},R_p$

步骤：

1. 计算$\omega_p=\frac{2\pi f_p}{f_s},\omega_{st}=\frac{2\pi f_{st}}{f_s}$
2. 预畸 $\Omega_p=cot\frac{\omega_p}{2},\Omega_{st}=cot\frac{\omega_{st}}{2}$
3. 计算N和截止频率
4. 去归一化得到$H_{hp}(z)=H_a(s)|_{s=\frac{1+z^{-1}}{1-z^{-1}}}$



##### 数字带通

$cos\omega_0=\frac{cos(\frac{\omega_{p1} + \omega_{p2}}{2})}{cos(\frac{\omega_{p1} - \omega_{p2}}{2})}$ 注意大减小

$s=\frac{1-2z^{-1}cos\omega_0+z^{-2}}{1-z^{-2}}$

$\Omega=\frac{cos\omega_0-cos\omega}{sin\omega}$

给定$f_{st1},f_{st2},f_{p1},f_{p2},f_s,A_{st},R_p$

步骤：

1. 获得 $\omega_{p1},\omega_{p2},\omega_{st1},\omega_{st2},$
2. 获取中心频率 $cos\omega_0=\frac{cos(\frac{\omega_{p1} + \omega_{p2}}{2})}{cos(\frac{\omega_{p1} - \omega_{p2}}{2})}$
3. 获得模拟频率：

$\Omega_p=\frac{cos\omega_0-cos\omega_{p2}}{sin\omega_{p2}}$注意选择更远的频率$\omega_{p2}$

$\Omega_{st1}=\frac{cos\omega_0-cos\omega_{st1}}{sin\omega_{st1}}$

$\Omega_{st2}=\frac{cos\omega_0-cos\omega_{st2}}{sin\omega_{st2}}$

$\Omega_{st}=min(|\Omega_{st1}|,|\Omega_{st2}|)$

4. 计算N和截止频率
5. 去归一化获得$H_a(s)$
6. 直接转换：$H_{bp}(z)=H_a(s)|_{s=\frac{1-2z^{-1}cos\omega_0+z^{-2}}{1-z^{-2}}}$



##### 数字带阻

$cos\omega_0=\frac{cos(\frac{\omega_{p1} + \omega_{p2}}{2})}{cos(\frac{\omega_{p1} - \omega_{p2}}{2})}$ 注意大减小，和带通是一样的

$s=\frac{1-z^{-2}}{1-2z^{-1}cos\omega_0+z^{-2}}$

$\Omega=\frac{sin\omega}{cos\omega_0-cos\omega}$

给定$f_{st1},f_{st2},f_{p1},f_{p2},f_s,A_{st},R_p$

步骤：

1. 获得 $\omega_{p1},\omega_{p2},\omega_{st1},\omega_{st2},$
2. 获取中心频率 $cos\omega_0=\frac{cos(\frac{\omega_{p1} + \omega_{p2}}{2})}{cos(\frac{\omega_{p1} - \omega_{p2}}{2})}$
3. 获得模拟频率：

$\Omega_{st}=\frac{sin\omega_{st1}}{cos\omega_0-cos\omega_{st1}}$注意选择更近的频率 $\omega_{st1}$

$\Omega_{p1}=\frac{sin\omega_{p1}}{cos\omega_{p1}-cos\omega_0}$

$\Omega_{p2}=\frac{cos\omega_0-cos\omega_{p2}}{sin\omega_{p2}}$

$\Omega_{p}=max(|\Omega_{p1}|,|\Omega_{p2}|)$

4. 计算N和截止频率
5. 去归一化获得$H_a(s)$
6. 直接转换：$H_{bs}(z)=H_a(s)|_{s=\frac{1-z^{-2}}{1-2z^{-1}cos\omega_0+z^{-2}}}$

### 数字FIR

单位冲击响应奇偶对称，范围N奇数偶数，有4种组合方式

窗函数设计

N奇对偶

可以设计任意滤波器

N奇对奇

N偶对偶

N偶对奇



单位抽样响应：

低通

$h_d(n)=\frac{sin[\omega_c(n-\tau)]}{\pi(n-\tau)}, n\neq\tau$

$h_d(n)=\frac{\omega_c}{\pi}n=\tau$

高通

$h_d(n)=-\frac{sin[\omega_c(n-\tau)]}{\pi(n-\tau)},\quad n\neq\tau$

$h_d(n)=1-\frac{\omega_c}{\pi},\quad n=\tau$

带通

$h_d(n)=\frac{1}{\pi(n-\tau)}\{ sin[\omega_2(n-\tau)]-sin[\omega_1(n-\tau)]\},\quad n\neq \tau$

$\frac{\omega_2-\omega_1}{\pi},\quad n=\tau$

带阻

$h_d(n)=\frac{1}{\pi(n-\tau)}\{sin[\pi(n-\tau)]- sin[\omega_2(n-\tau)]+sin[\omega_1(n-\tau)]\},\quad n\neq \tau$

$1-\frac{\omega_2-\omega_1}{\pi},\quad n=\tau$



窗函数设计法步骤：

给定 $\omega_p,\omega_{st},R_p,A_{st}$

1. 计算理想线性相位滤波器

<img src=".\fig\参数.png" style="zoom:80%;" />

<img src=".\fig\FIR.png" style="zoom:80%;" />

2. 根据$A_s$选择相应的窗，由窗的长度表达式计算N，得到w（n）
3. $h(n)=h_d(n)w(n)$，$h_d(n)$由滤波器类型得到。
4. 检验是否符合要求（一般都是符合的）











